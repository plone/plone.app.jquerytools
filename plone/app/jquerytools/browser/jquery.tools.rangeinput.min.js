var oldFnData=jQuery.fn.data;jQuery.fn.data=function(name){var ret,evt,elem=this[0];return elem&&"events"===name&&1===arguments.length&&(ret=jQuery.data(elem,name),evt=jQuery._data(elem,name)),oldFnData.apply(this,arguments)},function($){function round(value,precision){var n=Math.pow(10,precision);return Math.round(value*n)/n}function dim(el,key){var v=parseInt(el.css(key),10);if(v)return v;var s=el[0].currentStyle;return s&&s.width&&parseInt(s.width,10)}function hasEvent(el){var e=el.data("events");return e&&e.onSlide}function RangeInput(input,conf){function slide(evt,x,val,isSetValue){if(void 0===val?val=x/len*range:isSetValue&&(val-=conf.min),step&&(val=Math.round(val/step)*step),(void 0===x||step)&&(x=val*len/range),isNaN(val))return self;x=Math.max(0,Math.min(x,len)),val=x/len*range,!isSetValue&&vertical||(val+=conf.min),vertical&&(isSetValue?x=len-x:val=conf.max-val),val=round(val,precision);var isClick="click"==evt.type;if(fireOnSlide&&void 0!==value&&!isClick&&(evt.type="onSlide",fire.trigger(evt,[val,x]),evt.isDefaultPrevented()))return self;var speed=isClick?conf.speed:0,callback=isClick?function(){evt.type="change",fire.trigger(evt,[val])}:null;return vertical?(handle.animate({top:x},speed,callback),conf.progress&&progress.animate({height:len-x+handle.height()/2},speed)):(handle.animate({left:x},speed,callback),conf.progress&&progress.animate({width:x+handle.width()/2},speed)),value=val,pos=x,input.val(val),self}function init(){vertical=conf.vertical||dim(root,"height")>dim(root,"width"),vertical?(len=dim(root,"height")-dim(handle,"height"),origo=root.offset().top+len):(len=dim(root,"width")-dim(handle,"width"),origo=root.offset().left)}function begin(){init(),self.setValue(void 0!==conf.value?conf.value:conf.min)}var vertical,value,origo,len,pos,self=this,css=conf.css,root=$("<div><div/><a href='#'/></div>").data("rangeinput",self);input.before(root);var handle=root.addClass(css.slider).find("a").addClass(css.handle),progress=root.find("div").addClass(css.progress);$.each("min,max,step,value".split(","),function(i,key){var val=input.attr(key);parseFloat(val)&&(conf[key]=parseFloat(val,10))});var range=conf.max-conf.min,step="any"==conf.step?0:conf.step,precision=conf.precision;if(void 0===precision&&(precision=step.toString().split("."),precision=2===precision.length?precision[1].length:0),"range"==input.attr("type")){var def=input.clone().wrap("<div/>").parent().html(),clone=$(def.replace(/type/i,"type=text data-orig-type"));clone.val(conf.value),input.replaceWith(clone),input=clone}input.addClass(css.input);var fire=$(self).add(input),fireOnSlide=!0;$.extend(self,{getValue:function(){return value},setValue:function(val,e){return init(),slide(e||$.Event("api"),void 0,val,!0)},getConf:function(){return conf},getProgress:function(){return progress},getHandle:function(){return handle},getInput:function(){return input},step:function(am,e){e=e||$.Event();var step="any"==conf.step?1:conf.step;self.setValue(value+step*(am||1),e)},stepUp:function(am){return self.step(am||1)},stepDown:function(am){return self.step(-am||-1)}}),$.each("onSlide,change".split(","),function(i,name){$.isFunction(conf[name])&&$(self).on(name,conf[name]),self[name]=function(fn){return fn&&$(self).on(name,fn),self}}),handle.drag({drag:!1}).on("dragStart",function(){init(),fireOnSlide=hasEvent($(self))||hasEvent(input)}).on("drag",function(e,y,x){return!input.is(":disabled")&&void slide(e,vertical?y:x)}).on("dragEnd",function(e){e.isDefaultPrevented()||(e.type="change",fire.trigger(e,[value]))}).click(function(e){return e.preventDefault()}),root.click(function(e){if(input.is(":disabled")||e.target==handle[0])return e.preventDefault();init();var fix=vertical?handle.height()/2:handle.width()/2;slide(e,vertical?len-origo-fix+e.pageY:e.pageX-origo-fix)}),conf.keyboard&&input.keydown(function(e){if(!input.attr("readonly")){var key=e.keyCode,up=$([75,76,38,33,39]).index(key)!=-1,down=$([74,72,40,34,37]).index(key)!=-1;return!up&&!down||e.shiftKey||e.altKey||e.ctrlKey?void 0:(up?self.step(33==key?10:1,e):down&&self.step(34==key?-10:-1,e),e.preventDefault())}}),input.blur(function(e){var val=$(this).val();val!==value&&self.setValue(val,e)}),$.extend(input[0],{stepUp:self.stepUp,stepDown:self.stepDown}),begin(),len||$(window).load(begin)}$.tools=$.tools||{version:"@VERSION"};var tool;tool=$.tools.rangeinput={conf:{min:0,max:100,step:"any",steps:0,value:0,precision:void 0,vertical:0,keyboard:!0,progress:!1,speed:100,css:{input:"range",slider:"slider",progress:"progress",handle:"handle"}}};var doc,draggable;$.fn.drag=function(conf){return document.ondragstart=function(){return!1},conf=$.extend({x:!0,y:!0,drag:!0},conf),doc=doc||$(document).on("mousedown mouseup",function(e){var el=$(e.target);if("mousedown"==e.type&&el.data("drag")){var offset=el.position(),x0=e.pageX-offset.left,y0=e.pageY-offset.top,start=!0;doc.on("mousemove.drag",function(e){var x=e.pageX-x0,y=e.pageY-y0,props={};conf.x&&(props.left=x),conf.y&&(props.top=y),start&&(el.trigger("dragStart"),start=!1),conf.drag&&el.css(props),el.trigger("drag",[y,x]),draggable=el}),e.preventDefault()}else try{draggable&&draggable.trigger("dragEnd")}finally{doc.off("mousemove.drag"),draggable=null}}),this.data("drag",!0)},$.expr[":"].range=function(el){var type=el.getAttribute("type");return type&&"range"==type||!!$(el).filter("input").data("rangeinput")},$.fn.rangeinput=function(conf){if(this.data("rangeinput"))return this;conf=$.extend(!0,{},tool.conf,conf);var els;return this.each(function(){var el=new RangeInput($(this),$.extend(!0,{},conf)),input=el.getInput().data("rangeinput",el);els=els?els.add(input):input}),els?els:this}}(jQuery);