!function($){function getPosition(trigger,el,conf){el=$(el).first()||el;var top=trigger.offset().top,left=trigger.offset().left,pos=conf.position.split(/,?\s+/),y=pos[0],x=pos[1];top-=el.outerHeight()-conf.offset[0],left+=trigger.outerWidth()+conf.offset[1],/iPad/i.test(navigator.userAgent)&&(top-=$(window).scrollTop());var height=el.outerHeight()+trigger.outerHeight();"center"==y&&(top+=height/2),"bottom"==y&&(top+=height);var width=trigger.outerWidth();return"center"==x&&(left-=(width+el.outerWidth())/2),"left"==x&&(left-=width),{top:top,left:left}}function isType(type){function fn(){return this.getAttribute("type")==type}return fn.key='[type="'+type+'"]',fn}function Validator(inputs,form,conf){function pushMessage(to,matcher,returnValue){if(conf.grouped||!to.length){var msg;if(returnValue===!1||$.isArray(returnValue)){msg=v.messages[matcher.key||matcher]||v.messages["*"],msg=msg[conf.lang]||v.messages["*"].en;var matches=msg.match(/\$\d/g);matches&&$.isArray(returnValue)&&$.each(matches,function(i){msg=msg.replace(this,returnValue[i])})}else msg=returnValue[conf.lang]||returnValue;to.push(msg)}}var self=this,fire=form.add(self);inputs=inputs.not(":button, :image, :reset, :submit"),form.attr("novalidate","novalidate"),$.extend(self,{getConf:function(){return conf},getForm:function(){return form},getInputs:function(){return inputs},reflow:function(){return inputs.each(function(){var input=$(this),msg=input.data("msg.el");if(msg){var pos=getPosition(input,msg,conf);msg.css({top:pos.top,left:pos.left})}}),self},invalidate:function(errs,e){if(!e){var errors=[];$.each(errs,function(key,val){var input=inputs.filter("[name='"+key+"']");input.length&&(input.trigger("OI",[val]),errors.push({input:input,messages:[val]}))}),errs=errors,e=$.Event()}return e.type="onFail",fire.trigger(e,[errs]),e.isDefaultPrevented()||effects[conf.effect][0].call(self,errs,e),self},reset:function(els){return els=els||inputs,els.removeClass(conf.errorClass).each(function(){var msg=$(this).data("msg.el");msg&&(msg.remove(),$(this).data("msg.el",null))}).off(conf.errorInputEvent+".v"||""),self},destroy:function(){return form.off(conf.formEvent+".V reset.V"),inputs.off(conf.inputEvent+".V change.V"),self.reset()},checkValidity:function(els,e){els=els||inputs,els=els.not(":disabled");var names={};if(els=els.filter(function(){var name=$(this).attr("name");if(!names[name])return names[name]=!0,$(this)}),!els.length)return!0;if(e=e||$.Event(),e.type="onBeforeValidate",fire.trigger(e,[els]),e.isDefaultPrevented())return e.result;var errs=[];els.each(function(){var msgs=[],el=$(this).data("messages",msgs),event=dateInput&&el.is(":date")?"onHide.v":conf.errorInputEvent+".v";if(el.off(event),$.each(fns,function(){var fn=this,match=fn[0];if(el.filter(match).length){var returnValue=fn[1].call(self,el,el.val());if(returnValue!==!0){if(e.type="onBeforeFail",fire.trigger(e,[el,match]),e.isDefaultPrevented())return!1;var msg=el.attr(conf.messageAttr);if(msg)return msgs=[msg],!1;pushMessage(msgs,match,returnValue)}}}),msgs.length&&(errs.push({input:el,messages:msgs}),el.trigger("OI",[msgs]),conf.errorInputEvent&&el.on(event,function(e){self.checkValidity(el,e)})),conf.singleError&&errs.length)return!1});var eff=effects[conf.effect];if(!eff)throw'Validator: cannot find effect "'+conf.effect+'"';return errs.length?(self.invalidate(errs,e),!1):(eff[1].call(self,els,e),e.type="onSuccess",fire.trigger(e,[els]),els.off(conf.errorInputEvent+".v"),!0)}}),$.each("onBeforeValidate,onBeforeFail,onFail,onSuccess".split(","),function(i,name){$.isFunction(conf[name])&&$(self).on(name,conf[name]),self[name]=function(fn){return fn&&$(self).on(name,fn),self}}),conf.formEvent&&form.on(conf.formEvent+".V",function(e){return self.checkValidity(null,e)?(e.target=form,void(e.type=conf.formEvent)):e.preventDefault()}),form.on("reset.V",function(){self.reset()}),inputs[0]&&inputs[0].validity&&inputs.each(function(){this.oninvalid=function(){return!1}}),form[0]&&(form[0].checkValidity=self.checkValidity),conf.inputEvent&&inputs.on(conf.inputEvent+".V",function(e){self.checkValidity($(this),e)}),inputs.filter(":checkbox, select").filter("[required]").on("change.V",function(e){var el=$(this);(this.checked||el.is("select")&&$(this).val())&&effects[conf.effect][1].call(self,el,e)}),inputs.filter(":radio[required]").on("change.V",function(e){var els=$("[name='"+$(e.srcElement).attr("name")+"']");null!=els&&0!=els.length&&self.checkValidity(els,e)}),$(window).resize(function(){self.reflow()})}$.tools=$.tools||{version:"@VERSION"};var v,typeRe=/\[type=([a-z]+)\]/,numRe=/^-?[0-9]*(\.[0-9]+)?$/,dateInput=$.tools.dateinput,emailRe=/^([a-z0-9_\.\-\+]+)@([\da-z\.\-]+)\.([a-z\.]{2,6})$/i,urlRe=/^(https?:\/\/)?[\da-z\.\-]+\.[a-z\.]{2,6}[#&+_\?\/\w \.\-=]*$/i;v=$.tools.validator={conf:{grouped:!1,effect:"default",errorClass:"invalid",inputEvent:null,errorInputEvent:"keyup",formEvent:"submit",lang:"en",message:"<div/>",messageAttr:"data-message",messageClass:"error",offset:[0,0],position:"center right",singleError:!1,speed:"normal"},messages:{"*":{en:"Please correct this value"}},localize:function(lang,messages){$.each(messages,function(key,msg){v.messages[key]=v.messages[key]||{},v.messages[key][lang]=msg})},localizeFn:function(key,messages){v.messages[key]=v.messages[key]||{},$.extend(v.messages[key],messages)},fn:function(matcher,msg,fn){$.isFunction(msg)?fn=msg:("string"==typeof msg&&(msg={en:msg}),this.messages[matcher.key||matcher]=msg);var test=typeRe.exec(matcher);test&&(matcher=isType(test[1])),fns.push([matcher,fn])},addEffect:function(name,showFn,closeFn){effects[name]=[showFn,closeFn]}};var fns=[],effects={default:[function(errs){var conf=this.getConf();$.each(errs,function(i,err){var input=err.input;input.addClass(conf.errorClass);var msg=input.data("msg.el");msg||(msg=$(conf.message).addClass(conf.messageClass).appendTo(document.body),input.data("msg.el",msg)),msg.css({visibility:"hidden"}).find("p").remove(),$.each(err.messages,function(i,m){$("<p/>").html(m).appendTo(msg)}),msg.outerWidth()==msg.parent().width()&&msg.add(msg.find("p")).css({display:"inline"});var pos=getPosition(input,msg,conf);msg.css({visibility:"visible",position:"absolute",top:pos.top,left:pos.left}).fadeIn(conf.speed)})},function(inputs){var conf=this.getConf();inputs.removeClass(conf.errorClass).each(function(){var msg=$(this).data("msg.el");msg&&msg.css({visibility:"hidden"})})}]};$.each("email,url,number".split(","),function(i,key){$.expr[":"][key]=function(el){return el.getAttribute("type")===key}}),$.fn.oninvalid=function(fn){return this[fn?"on":"trigger"]("OI",fn)},v.fn(":email","Please enter a valid email address",function(el,v){return!v||emailRe.test(v)}),v.fn(":url","Please enter a valid URL",function(el,v){return!v||urlRe.test(v)}),v.fn(":number","Please enter a numeric value.",function(el,v){return numRe.test(v)}),v.fn("[max]","Please enter a value no larger than $1",function(el,v){if(""===v||dateInput&&el.is(":date"))return!0;var max=el.attr("max");return parseFloat(v)<=parseFloat(max)||[max]}),v.fn("[min]","Please enter a value of at least $1",function(el,v){if(""===v||dateInput&&el.is(":date"))return!0;var min=el.attr("min");return parseFloat(v)>=parseFloat(min)||[min]}),v.fn("[required]","Please complete this mandatory field.",function(el,v){return el.is(":checkbox")?el.is(":checked"):!!v}),v.fn("[pattern]",function(el,v){return""===v||new RegExp("^"+el.attr("pattern")+"$").test(v)}),v.fn(":radio[required]","Please select an option.",function(el){var checked=!1;$("[name='"+el.attr("name")+"']").each(function(i,el){($(el).is(":checked")||checked)&&(checked=!0)});return!!checked}),$.fn.validator=function(conf){var instance=this.data("validator");return instance&&(instance.destroy(),this.removeData("validator")),conf=$.extend(!0,{},v.conf,conf),this.is("form")?this.each(function(){var form=$(this);instance=new Validator(form.find(":input"),form,conf),form.data("validator",instance)}):(instance=new Validator(this,this.eq(0).closest("form"),conf),this.data("validator",instance))}}(jQuery);